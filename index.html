<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Security Headers - UPDATED FOR SUPABASE -->
    <meta http-equiv="Content-Security-Policy" 
          content="default-src 'self'; 
                   script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net; 
                   style-src 'self' 'unsafe-inline'; 
                   img-src 'self' data: https:; 
                   connect-src 'self' https://api.ipify.org https://rggqgrjovqncorratqxh.supabase.co;
                   font-src 'self';
                   object-src 'none';
                   base-uri 'self';
                   form-action 'self'">
    
    <meta http-equiv="Strict-Transport-Security" content="max-age=31536000; includeSubDomains">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta http-equiv="X-XSS-Protection" content="1; mode=block">
    <meta http-equiv="Referrer-Policy" content="strict-origin-when-cross-origin">
    
    <title>The Conclusion Daily - Quiz</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="root">
        <div style="padding: 20px; text-align: center;">
            <h1>Loading Quiz App...</h1>
            <p>Please wait while the app loads.</p>
        </div>
    </div>

    <!-- üöÄ LOAD SUPABASE LIBRARY FIRST -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- EMERGENCY FUNCTIONS -->
    <script>
        console.log('üîÑ Loading emergency functions...');
        
        // Global logout function
        window.logout = window.secureLogout = function() {
            console.log('üö™ Emergency logout called');
            try {
                localStorage.clear();
                sessionStorage.clear();
                window.location.href = '/';
            } catch (error) {
                window.location.href = '/';
            }
        };
        
        // Safe function to show login screen
        window.showLoginScreen = function() {
            const root = document.getElementById('root');
            if (root) {
                root.innerHTML = `
                    <div style="padding: 20px; text-align: center;">
                        <h1>Please Log In</h1>
                        <p>Redirecting to login...</p>
                    </div>
                `;
            }
        };
        
        console.log('‚úÖ Emergency functions loaded');
    </script>

    <!-- üöÄ LOAD SUPABASE CONFIGURATION -->
    <script src="supabase.js"></script>

    <!-- Load main app -->
    <script src="app.js"></script>
    
    <!-- Load status checker -->
    <script>
        console.log('üîç Checking script loading status...');
        
        // Check if Supabase loaded properly
        setTimeout(function() {
            console.log('Supabase library:', typeof supabase);
            console.log('Supabase client:', window.supabaseClient);
            console.log('Test function:', typeof window.testSupabase);
            
            if (!window.supabaseClient) {
                console.error('‚ùå Supabase client failed to load');
                const root = document.getElementById('root');
                if (root && root.innerHTML.includes('Loading')) {
                    root.innerHTML = `
                        <div style="padding: 20px; text-align: center; color: red;">
                            <h1>Database Connection Error</h1>
                            <p>Supabase failed to load. Check the console for errors.</p>
                            <button onclick="window.location.reload()" style="padding: 10px 20px;">
                                Reload Page
                            </button>
                        </div>
                    `;
                }
            } else {
                console.log('‚úÖ All scripts loaded successfully');
            }
        }, 1000);
    </script>
</body>
</html>